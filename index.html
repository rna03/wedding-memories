<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ’ DÃ¼ÄŸÃ¼n HatÄ±ralarÄ±</title>
  <style>
    :root {
      --gold: #c9a227;
      --bg: #fffaf5;
      --ink: #2b2b2b;
      --line: #ead9b0;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      background: var(--bg); color: var(--ink);
      display: flex; flex-direction: column; align-items: center;
    }
    header {
      width: 100%; padding: 28px 16px; text-align: center;
      background: linear-gradient(180deg, #fff, #fff8ec);
      border-bottom: 1px solid var(--line);
    }
    h1 { margin: 0 0 8px; font-weight: 700; letter-spacing: 0.5px; }
    .subtitle { color: #6b6b6b; }
    .card {
      background: #fff; border: 1px solid var(--line); border-radius: 16px;
      width: min(720px, 92vw); margin: 18px auto; padding: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 760px){ .row { grid-template-columns: 1fr 1fr; } }
    .box {
      padding: 16px; border: 2px dashed var(--line); border-radius: 12px; text-align: center;
    }
    .box h3 { margin: 4px 0 8px; color: var(--gold); }
    button, input[type="file"], textarea {
      width: 100%; padding: 12px 14px; border-radius: 10px;
      border: 1px solid var(--line); font-size: 15px; outline: none;
    }
    button {
      cursor: pointer; border: none; background: var(--gold); color: #fff; font-weight: 600;
    }
    button[disabled] { opacity: .6; cursor: not-allowed; }
    textarea { min-height: 110px; resize: vertical; }
    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
    .tile { border: 1px solid var(--line); border-radius: 10px; padding: 8px; background: #fff; }
    .tile a { word-break: break-all; font-size: 12px; display: inline-block; margin-top: 6px; }
    .muted { color:#777; font-size: 13px; }
    .footer { margin: 24px 0 36px; color:#888; font-size: 13px; text-align:center; }
    .success { border: 1px solid #d6f5df; background: #f5fffa; color:#0a6b2d; padding:10px; border-radius:8px; }
    .error { border: 1px solid #ffd6d6; background: #fff5f5; color:#9d0b0b; padding:10px; border-radius:8px; }
    .qr-hint { text-align:center; margin-top:8px; font-size: 13px; color:#666; }
  </style>
</head>
<body>
  <header>
    <h1>ğŸ’ DÃ¼ÄŸÃ¼n HatÄ±ralarÄ±</h1>
    <div class="subtitle">FotoÄŸraf yÃ¼kleyin, sesli mesaj bÄ±rakÄ±n, gÃ¼zel bir not yazÄ±n ğŸ‰</div>
  </header>

  <main class="card">
    <div class="row">
      <!-- FOTOÄRAF / VÄ°DEO / SES DOSYASI YÃœKLE -->
      <section class="box">
        <h3>ğŸ“¸ FotoÄŸraf / ğŸï¸ Video / ğŸ§ Dosya yÃ¼kle</h3>
        <input id="fileInput" type="file" accept="image/*,video/*,audio/*" />
        <div style="height:8px;"></div>
        <button id="btnUploadFile">YÃ¼kle</button>
        <div id="fileMsg" class="muted" style="margin-top:8px;"></div>
      </section>

      <!-- MÄ°KROFONDAN SES KAYDET -->
      <section class="box">
        <h3>ğŸ¤ Mikrofondan Ses KaydÄ±</h3>
        <div style="display:flex; gap:8px;">
          <button id="btnStart">KaydÄ± BaÅŸlat</button>
          <button id="btnStop" disabled>KaydÄ± Durdur & YÃ¼kle</button>
        </div>
        <div class="muted" style="margin-top:8px;">TarayÄ±cÄ± izni isteyecek. KayÄ±t <code>.webm</code> olarak yÃ¼klenir.</div>
        <audio id="player" controls style="width:100%; margin-top:10px; display:none;"></audio>
        <div id="recMsg" class="muted" style="margin-top:8px;"></div>
      </section>
    </div>

    <!-- YAZILI NOT -->
    <section class="box" style="margin-top:12px;">
      <h3>ğŸ“ YazÄ±lÄ± Not BÄ±rak</h3>
      <textarea id="noteArea" placeholder="Mutluluklar dileriz! ğŸ’"></textarea>
      <button id="btnNote">Notu YÃ¼kle</button>
      <div class="muted" style="margin-top:8px;">Notlar Cloudinary'ye <code>.txt</code> dosyasÄ± olarak kaydedilir.</div>
      <div id="noteMsg" style="margin-top:8px;"></div>
    </section>

    <!-- SON AN EKLENENLER (bu sayfada gÃ¶sterim) -->
    <section style="margin-top:18px;">
      <h3>âœ¨ Bu oturumda yÃ¼kledikleriniz</h3>
      <div id="gallery" class="gallery"></div>
      <div class="muted" style="margin-top:8px;">
        Not: GÃ¼venlik nedeniyle Cloudinaryâ€™den eski yÃ¼klemeleri listemiyoruz (API Secret gerektirir).
        Burada sadece bu sayfayÄ± aÃ§Ä±kken yÃ¼kledikleriniz gÃ¶rÃ¼nÃ¼r.
      </div>
    </section>

    <!-- QR BÄ°LGÄ°SÄ° -->
    <section style="margin-top:18px; text-align:center;">
      <div class="qr-hint">
        Bu sayfayÄ± GitHub Pagesâ€™e koyduktan sonra linkinizi herhangi bir QR Ã¼reticiyle (Ã¶rn. QR Code Generator) koda dÃ¶nÃ¼ÅŸtÃ¼rÃ¼n.
      </div>
    </section>
  </main>

  <div class="footer">Sevgiyleâ€¦ ğŸ’›</div>

  <script>
    // === AYARLARINI BURADA DÃœZENLE ===
    const CLOUD_NAME = "ddbwmzqsr";      // Cloudinary cloud name'ini yaz
    const UPLOAD_PRESET = "wedding_upload"; // Unsigned preset adÄ±nÄ± yaz

    // -------- YardÄ±mcÄ±lar --------
    const sel = (q) => document.querySelector(q);
    const apiUrl = (resourceType = "auto") => `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/${resourceType}/upload`;

    function addTile({ url, kind, noteText }) {
      const box = document.createElement("div");
      box.className = "tile";
      if (kind === "image") {
        const img = document.createElement("img");
        img.src = url; img.alt = "upload"; img.style.width = "100%"; img.style.borderRadius = "6px";
        box.appendChild(img);
      } else if (kind === "audio") {
        const a = document.createElement("audio");
        a.controls = true; a.src = url; a.style.width = "100%";
        box.appendChild(a);
      } else if (kind === "video") {
        const v = document.createElement("video");
        v.controls = true; v.src = url; v.style.width = "100%";
        box.appendChild(v);
      } else if (kind === "note") {
        const p = document.createElement("div");
        p.textContent = noteText || "Not dosyasÄ±";
        p.style.whiteSpace = "pre-wrap";
        box.appendChild(p);
      }
      const link = document.createElement("a");
      link.href = url; link.target = "_blank"; link.rel = "noopener";
      link.textContent = url;
      box.appendChild(link);
      sel("#gallery").prepend(box);
    }

    async function uploadToCloudinary(file, resourceType = "auto") {
      const form = new FormData();
      form.append("file", file);
      form.append("upload_preset", UPLOAD_PRESET);
      const res = await fetch(apiUrl(resourceType), { method: "POST", body: form });
      if (!res.ok) throw new Error("YÃ¼kleme baÅŸarÄ±sÄ±z");
      return res.json();
    }

    // -------- 1) Dosya yÃ¼kle (image/video/audio) --------
    sel("#btnUploadFile").addEventListener("click", async () => {
      const elMsg = sel("#fileMsg");
      elMsg.textContent = "";
      const input = sel("#fileInput");
      const file = input.files[0];
      if (!file) { elMsg.textContent = "LÃ¼tfen bir dosya seÃ§in."; return; }

      try {
        sel("#btnUploadFile").disabled = true;
        elMsg.textContent = "YÃ¼kleniyorâ€¦";
        const type = file.type;

        // Cloudinary, audio/video'yu genellikle "video" resource type ile kabul eder.
        let resourceType = "auto"; // gÃ¼venli seÃ§im
        if (type.startsWith("audio/")) resourceType = "video";

        const data = await uploadToCloudinary(file, resourceType);
        elMsg.innerHTML = `<div class="success">YÃ¼klendi âœ”ï¸ <a href="${data.secure_url}" target="_blank">AÃ§</a></div>`;

        // Galeri kartÄ±
        let kind = "file";
        if (type.startsWith("image/")) kind = "image";
        else if (type.startsWith("audio/")) kind = "audio";
        else if (type.startsWith("video/")) kind = "video";
        addTile({ url: data.secure_url, kind });

        input.value = "";
      } catch (e) {
        elMsg.innerHTML = `<div class="error">Hata: ${e.message}</div>`;
      } finally {
        sel("#btnUploadFile").disabled = false;
      }
    });

    // -------- 2) Mikrofondan ses kaydÄ± --------
    let mediaRecorder, chunks = [];
    sel("#btnStart").addEventListener("click", async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        chunks = [];
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
        mediaRecorder.onstop = async () => {
          const blob = new Blob(chunks, { type: "audio/webm" });
          const file = new File([blob], `voice_${Date.now()}.webm`, { type: "audio/webm" });

          sel("#recMsg").textContent = "YÃ¼kleniyorâ€¦";
          sel("#btnStop").disabled = true;
          try {
            // Audio, Cloudinary'de "video" resource type ile yÃ¼klenir
            const data = await uploadToCloudinary(file, "video");
            sel("#player").style.display = "block";
            sel("#player").src = data.secure_url;
            sel("#recMsg").innerHTML = `<div class="success">Ses yÃ¼klendi âœ”ï¸ <a href="${data.secure_url}" target="_blank">AÃ§</a></div>`;
            addTile({ url: data.secure_url, kind: "audio" });
          } catch (e) {
            sel("#recMsg").innerHTML = `<div class="error">Hata: ${e.message}</div>`;
          }
        };
        mediaRecorder.start();
        sel("#btnStart").disabled = true;
        sel("#btnStop").disabled = false;
        sel("#recMsg").textContent = "KayÄ±t yapÄ±lÄ±yorâ€¦ KonuÅŸabilirsiniz.";
      } catch (e) {
        sel("#recMsg").innerHTML = `<div class="error">Mikrofona eriÅŸilemedi: ${e.message}</div>`;
      }
    });

    sel("#btnStop").addEventListener("click", () => {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        sel("#btnStart").disabled = false;
        sel("#btnStop").disabled = true;
        sel("#recMsg").textContent = "YÃ¼kleme baÅŸlatÄ±ldÄ±â€¦";
      }
    });

    // -------- 3) YazÄ±lÄ± notu .txt olarak yÃ¼kle --------
    sel("#btnNote").addEventListener("click", async () => {
      const area = sel("#noteArea");
      const text = (area.value || "").trim();
      const el = sel("#noteMsg");
      el.textContent = "";
      if (!text) { el.textContent = "LÃ¼tfen bir not yazÄ±n."; return; }
      try {
        sel("#btnNote").disabled = true;
        el.textContent = "YÃ¼kleniyorâ€¦";
        const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
        const file = new File([blob], `note_${Date.now()}.txt`, { type: "text/plain" });
        // .txt iÃ§in "raw" resource type daha saÄŸlÄ±klÄ±dÄ±r
        const data = await uploadToCloudinary(file, "raw");
        el.innerHTML = `<div class="success">Not kaydedildi âœ”ï¸ <a href="${data.secure_url}" target="_blank">GÃ¶r</a></div>`;
        addTile({ url: data.secure_url, kind: "note", noteText: text });
        area.value = "";
      } catch (e) {
        el.innerHTML = `<div class="error">Hata: ${e.message}</div>`;
      } finally {
        sel("#btnNote").disabled = false;
      }
    });
  </script>
</body>
</html>
